<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VFX BidBot - VFX Bidding tool</title>
  <style>
    html {
      font-size: 80%;
    }
    
    .rotate-180 {
      transform: rotate(180deg);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(0, 212, 255, 0.5);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 212, 255, 0.7);
    }
    
    /* Custom styles that Tailwind can't handle easily */
    
    body {
      font-size: 0.9rem;
    }
    .gradient-text {
      background: linear-gradient(45deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .tag-chip {
      background: rgba(124, 58, 237, 0.2);
      color: #a78bfa;
    }
    
    .selected-text {
      text-decoration: underline;
      background-color: #fffacd;
      color: inherit;
    }
    
    #scriptInput {
      white-space: pre-wrap;
      font-size: 0.8rem;
      line-height: 1.4;
    }
    
    /* Animation classes */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeOut {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
      }
    }
    
    .animate-fade-in-up {
      animation: fadeInUp 0.3s ease-out forwards;
    }
    
    .animate-fade-out {
      animation: fadeOut 0.3s ease-out forwards;
    }
    
    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
      
      .panel-height {
        height: 50vh;
      }
    }
    
    @media (min-width: 1920px) {
      .container {
        max-width: 1800px;
      }
    }
    
    /* Scene and shot input styling */
    .scene-shot-input {
      width: 60px;
      text-transform: uppercase;
    }
    
    .shot-input {
      width: 60px;
    }
    
    /* Stats table styling */
    .stats-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .stats-table th, .stats-table td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .stats-table th {
      background-color: rgba(0, 0, 0, 0.2);
      font-weight: 600;
    }
    
    .stats-table tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    /* Tag button active state */
    .tag-button.active {
      background: rgba(0, 212, 255, 0.2);
      border-color: rgba(0, 212, 255, 0.5);
      color: #00d4ff;
    }

    /* Font size slider styles */
    .font-size-control {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 20px;
    }

    .font-size-slider {
      -webkit-appearance: none;
      width: 100px;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      outline: none;
    }

    .font-size-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #00d4ff;
      cursor: pointer;
      transition: all 0.2s;
    }

    .font-size-slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: #00a8d4;
    }

    .font-size-value {
      min-width: 30px;
      text-align: center;
      font-size: 0.8rem;
      color: #00d4ff;
    }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-100 min-h-screen">
  <!-- Header -->
  <header class="bg-gray-900/90 backdrop-blur-md border-b border-gray-800 p-2 flex flex-col md:flex-row justify-between items-center sticky top-0 z-50">
    <div class="flex items-center space-x-2 mb-2 md:mb-0">
        <img src="https://iili.io/F0tWJ8N.png" alt="logo" class="h-6 w-6 object-contain" />
        <h1 class="text-xl font-bold gradient-text">BIDBOT (A script breakdown tool for VFX - by Mathieu Vierendeel)</h1>
    </div>
    <div class="flex flex-wrap justify-center gap-2">
      <button onclick="exportCSV()" class="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5">
        <i class="fas fa-file-export"></i>
        <span>Export CSV</span>
      </button>
      <button onclick="exportJSON()" class="flex items-center space-x-1 px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5">
        <i class="fas fa-code"></i>
        <span>Export JSON</span>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-3 py-4 grid main-grid grid-cols-1 lg:grid-cols-[70%_30%] gap-4 min-h-[calc(100vh-8rem)]">
    <!-- Script Panel -->
    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 overflow-hidden flex flex-col h-full">
      <div class="bg-gray-900/50 p-2 border-b border-gray-700 flex justify-between items-center">
        <h2 class="text-base font-semibold flex items-center space-x-1">
          <i class="fas fa-scroll text-cyan-400"></i>
          <span>Script (Paste here)</span>
        </h2>
        <div class="font-size-control">
          <i class="fas fa-font text-gray-400 text-sm"></i>
          <input 
             type="range"
             min="8"
             max="24"
             value="12"
             class="font-size-slider"
             id="fontSizeSlider"
            oninput="updateFontSize(this.value)"
          >
          <span class="font-size-value" id="fontSizeValue">12px</span>
        </div>
      </div>
      <div 
        id="scriptInput"
        contenteditable="true"
        onmouseup="storeSelection()"
        onkeyup="storeSelection()"
        class="flex-1 p-3 bg-gradient-to-b from-gray-100 to-gray-200 text-gray-900 font-mono overflow-auto focus:outline-none focus:ring-2 focus:ring-cyan-500/50 rounded-b-lg"
      >INT. LAB – DAY
A CG alien runs across the lab, knocking over glowing vials. The scientist yells and dives under a table as a monitor explodes.

EXT. FOREST – NIGHT
Fog rolls between the trees. A drone camera flies overhead. Lightning illuminates the alien spacecraft hovering above.

INT. SPACESHIP BRIDGE – CONTINUOUS
The alien commander studies Earth through a holographic display. Sparks fly from damaged control panels as alarms blare.

EXT. CITY STREET – DAY
A massive explosion rocks the downtown area. Cars flip through the air as debris rains down. Citizens run screaming as buildings collapse in the distance.</div>
    </div>

    <!-- Controls Panel -->
    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 overflow-hidden flex flex-col panel-height sticky top-[4.5rem] self-start">
      <!-- Tab Navigation -->
      <div class="bg-gray-900/50 flex border-b border-gray-700">
        <button 
           onclick="switchTab('tagging')"
           class="tab-button flex-1 py-3 px-4 text-center font-medium border-b-2 border-cyan-500 text-cyan-400 hover:bg-gray-800/50 transition-all flex items-center justify-center space-x-2"
           id="tagging-tab-btn"
        >
          <i class="fas fa-tag"></i>
          <span>VFX Tagging</span>
        </button>
        <button 
           onclick="switchTab('history')"
           class="tab-button flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent hover:bg-gray-800/50 transition-all flex items-center justify-center space-x-2"
           id="history-tab-btn"
        >
          <i class="fas fa-history"></i>
          <span>Tagged Shots</span>
          <span id="taggedCount" class="bg-cyan-500/20 text-cyan-400 text-2xs px-1.5 py-0.5 rounded-full">0</span>
        </button>
        <button 
           onclick="switchTab('stats')"
           class="tab-button flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent hover:bg-gray-800/50 transition-all flex items-center justify-center space-x-2"
           id="stats-tab-btn"
        >
          <i class="fas fa-chart-pie"></i>
          <span>Statistics</span>
        </button>
      </div>

      <!-- Tab Contents -->
      <div class="flex-1 overflow-auto">
        <!-- Tagging Tab -->
        <div id="tagging-tab" class="tab-content p-4 h-full">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-400 mb-2">Selected Text:</label>
            <div id="selectedPreview" class="bg-gray-900/50 border border-gray-700 rounded-lg p-3 text-gray-300 italic min-h-16">
              (Select text in the script to preview it here)
            </div>
          </div>

          <!-- Comment Section -->
          <div class="mb-4">
            <label for="commentBox" class="block text-sm font-medium text-gray-400 mb-2">
              <i class="fas fa-comment-dots mr-2"></i>Additional Notes:
            </label>
            <textarea
              id="commentBox"
              placeholder="Add any additional notes about the VFX requirements..."
              class="w-full px-3 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300 min-h-24 text-sm"
            ></textarea>
          </div>

          <!-- Scene and Shot Input -->
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div>
              <label for="sceneInput" class="block text-sm font-medium text-gray-400 mb-1">
                <i class="fas fa-map-marker-alt mr-1"></i>Scene (3-4 letters)
              </label>
              <input
                type="text"
                id="sceneInput"
                maxlength="4"
                placeholder="SCN"
                class="scene-shot-input w-full px-3 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300 text-sm uppercase"
              >
            </div>
            <div>
              <label for="shotInput" class="block text-sm font-medium text-gray-400 mb-1">
                <i class="fas fa-hashtag mr-1"></i>Shot (3-4 digits)
              </label>
              <input
                type="text"
                id="shotInput"
                maxlength="4"
                placeholder="001"
                class="shot-input w-full px-3 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300 text-sm"
              >
            </div>
          </div>

          <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 mb-4">
            <button
              onclick="tagVFX()"
              class="flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5"
            >
              <i class="fas fa-tag"></i>
              <span>Tag VFX</span>
            </button>
            <button
              onclick="clearSelection()"
              class="flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5"
            >
              <i class="fas fa-eraser"></i>
              <span>Clear Selection</span>
            </button>
          </div>

          <div class="relative mb-4">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search text-gray-500"></i>
            </div>
            <input 
               type="text"
              id="tagSearch"
              placeholder="Search tags..."
              onkeyup="filterTags()"
              class="w-full pl-10 pr-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300"
            >
          </div>

          <!-- Accordion for Tag Groups -->
          <div class="space-y-4">
            <!-- 2D COMP & DMP -->
            <div class="tag-group" data-category="2d-comp">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-layer-group"></i>
                  <span>2D COMP & DMP</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform duration-200"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D COMP COMPLEX
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D COMP MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D COMP SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D DMP COMPLEX
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D DMP MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D DMP SIMPL
                </button>
              </div>
            </div>

            <!-- CROWDS -->
            <div class="tag-group" data-category="crowds">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-users"></i>
                  <span>CROWDS</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D CROWD DUPL COMPLEX
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D CROWD DUPL MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D CROWD DUPL SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D CROWDS SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D CROWDS MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D CROWDS COMPLEX
                </button>
              </div>
            </div>

            <!-- 2D OTHER -->
            <div class="tag-group" data-category="2d-other">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-shapes"></i>
                  <span>2D OTHER</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D BLOOD/MUZZLE FLASH/BULLET HIT
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D FACE REPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D FILTER
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D FX STOCK FOOTAGE
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D HUD OVERLAY
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  2D SCREEN REPLACEMENT
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  TITLE CARD
                </button>
              </div>
            </div>

            <!-- 3D FULL CGI -->
            <div class="tag-group" data-category="3d-full-cgi">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-cube"></i>
                  <span>3D FULL CGI</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D FULL CGI SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D FULL CGI MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D FULL CGI COMPLEX
                </button>
              </div>
            </div>

            <!-- 3D ENVIRO -->
            <div class="tag-group" data-category="3d-enviro">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-mountain"></i>
                  <span>3D ENVIRO</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D ENVIRO SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D ENVIRO MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D ENVIRO COMPLEX
                </button>
              </div>
            </div>

            <!-- 3D OBJECT -->
            <div class="tag-group" data-category="3d-object">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-cube"></i>
                  <span>3D OBJECT</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D OBJECT SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D OBJECT MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D OBJECT COMPLEX
                </button>
              </div>
            </div>

            <!-- 3D CHARACTER -->
            <div class="tag-group" data-category="3d-character">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-user-astronaut"></i>
                  <span>3D CHARACTER</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D CHARACTER SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D CHARACTER MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D CHARACTER COMPLEX
                </button>
              </div>
            </div>

            <!-- 3D FX -->
            <div class="tag-group" data-category="3d-fx">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-fire"></i>
                  <span>3D FX</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D FX SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D FX MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  3D FX COMPLEX
                </button>
              </div>
            </div>

            <!-- PREVIS -->
            <div class="tag-group" data-category="previs">
              <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                  <i class="fas fa-video"></i>
                  <span>PREVIS</span>
                </h3>
                <i class="fas fa-chevron-down text-gray-500 transform transition-transform"></i>
              </div>
              <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-3 gap-2 p-2 hidden">
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  PREVIS SIMPL
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  PREVIS MED
                </button>
                <button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  PREVIS COMPLEX
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content p-4 hidden h-full">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-cyan-400">Tagged Shots</h3>
            <button onclick="clearAllTags()" class="px-3 py-1 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg text-sm transition-all">
              <i class="fas fa-trash mr-1"></i> Clear All
            </button>
          </div>
          <div id="taggedShotsList" class="space-y-2 overflow-auto max-h-[calc(100%-3rem)]">
            <!-- Tagged shots will appear here -->
          </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content p-4 hidden h-full">
          <h3 class="text-lg font-semibold text-cyan-400 mb-4">Statistics</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gray-900/50 rounded-lg p-4">
              <h4 class="text-sm font-medium text-gray-400 mb-2">VFX Count by Type</h4>
              <div id="vfxTypeChart" class="h-48">
                <!-- Chart will be rendered here -->
              </div>
            </div>
            <div class="bg-gray-900/50 rounded-lg p-4">
              <h4 class="text-sm font-medium text-gray-400 mb-2">Complexity Breakdown</h4>
              <div id="complexityChart" class="h-48">
                <!-- Chart will be rendered here -->
              </div>
            </div>
          </div>
          <div class="mt-4 bg-gray-900/50 rounded-lg p-4">
            <h4 class="text-sm font-medium text-gray-400 mb-2">Detailed Statistics</h4>
            <table class="stats-table w-full">
              <thead>
                <tr>
                  <th>VFX Type</th>
                  <th>Simple</th>
                  <th>Medium</th>
                  <th>Complex</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="statsTableBody">
                <!-- Stats will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Global variables
    let currentSelection = null;
    let selectedTag = null;
    let taggedShots = [];
    let fontSize = 12;

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      updateFontSize(12);
      loadFromLocalStorage();
      updateTaggedCount();
    });

    // Store the current text selection
    function storeSelection() {
      const selection = window.getSelection();
      if (selection && selection.rangeCount > 0 && !selection.isCollapsed) {
        currentSelection = selection.getRangeAt(0);
        
        // Update the preview
        const preview = document.getElementById('selectedPreview');
        preview.textContent = currentSelection.toString();
        preview.classList.remove('italic');
      }
    }

    // Update font size of script input
    function updateFontSize(size) {
      fontSize = size;
      document.getElementById('scriptInput').style.fontSize = `${size}px`;
      document.getElementById('fontSizeValue').textContent = `${size}px`;
    }

    // Select a VFX tag (can select multiple)
    function selectTag(button) {
      // Toggle active state
      button.classList.toggle('active');
      
      // Get all active tags
      selectedTag = Array.from(document.querySelectorAll('.tag-button.active'))
        .map(btn => btn.textContent.trim())
        .join(', ');
    }

    // Tag the selected text with VFX
    function tagVFX() {
      const activeTags = Array.from(document.querySelectorAll('.tag-button.active'))
        .map(btn => btn.textContent.trim());
      
      if (!currentSelection || activeTags.length === 0) {
        alert('Please select text in the script and choose at least one VFX tag.');
        return;
      }

      const scene = document.getElementById('sceneInput').value.trim() || 'SCN';
      const shot = document.getElementById('shotInput').value.trim() || '001';
      const comment = document.getElementById('commentBox').value.trim();
      
      // Get the selected text
      const selectedText = currentSelection.toString();
      
      // Create a span to highlight the tagged text
      const span = document.createElement('span');
      span.className = 'selected-text';
      span.dataset.scene = scene;
      span.dataset.shot = shot;
      span.dataset.tag = activeTags.join(', ');
      span.dataset.comment = comment;
      
      // Replace the selected text with our span
      currentSelection.deleteContents();
      span.appendChild(document.createTextNode(selectedText));
      currentSelection.insertNode(span);
      
      // Check if we already have this scene/shot combination
      const existingShot = taggedShots.find(s => 
        s.scene === scene && s.shot === shot && s.text === selectedText
      );
      
      if (existingShot) {
        // Merge tags
        const existingTags = existingShot.tag.split(', ');
        const newTags = [...new Set([...existingTags, ...activeTags])]; // Remove duplicates
        existingShot.tag = newTags.join(', ');
      } else {
        // Add new shot with all tags
        taggedShots.push({
          scene,
          shot,
          tag: activeTags.join(', '),
          text: selectedText,
          comment
        });
      }
      
      // Update UI
      updateTaggedCount();
      saveToLocalStorage();
      renderTaggedShots();
      
      // Clear selection
      clearSelection();
    }

    // Clear the current selection (keeps tags selected)
    function clearSelection() {
      currentSelection = null;
      document.getElementById('selectedPreview').textContent = '(Select text in the script to preview it here)';
      document.getElementById('selectedPreview').classList.add('italic');
      document.getElementById('commentBox').value = '';
    }

    // Switch between tabs
    function switchTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // Show selected tab
      document.getElementById(`${tabName}-tab`).classList.remove('hidden');
      
      // Update tab buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-cyan-500', 'text-cyan-400');
        btn.classList.add('border-transparent');
      });
      
      document.getElementById(`${tabName}-tab-btn`).classList.add('border-cyan-500', 'text-cyan-400');
      
      // If switching to stats tab, update stats
      if (tabName === 'stats') {
        updateStats();
      }
    }

    // Toggle accordion sections
    function toggleAccordion(header) {
      const content = header.nextElementSibling;
      const icon = header.querySelector('.fa-chevron-down');
      
      content.classList.toggle('hidden');
      icon.classList.toggle('rotate-180');
    }

    // Filter tags based on search input
    function filterTags() {
      const searchTerm = document.getElementById('tagSearch').value.toLowerCase();
      
      document.querySelectorAll('.tag-group').forEach(group => {
        let hasMatches = false;
        const buttons = group.querySelectorAll('.tag-button');
        
        buttons.forEach(button => {
          const tagText = button.textContent.toLowerCase();
          if (tagText.includes(searchTerm)) {
            button.style.display = 'block';
            hasMatches = true;
          } else {
            button.style.display = 'none';
          }
        });
        
        // Show/hide entire group based on matches
        if (hasMatches || searchTerm === '') {
          group.style.display = 'block';
        } else {
          group.style.display = 'none';
        }
      });
    }

    // Update the tagged shots count
    function updateTaggedCount() {
      document.getElementById('taggedCount').textContent = taggedShots.length;
    }

    // Render the list of tagged shots
    function renderTaggedShots() {
      const container = document.getElementById('taggedShotsList');
      container.innerHTML = '';
      
      if (taggedShots.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic text-center py-4">No tagged shots yet</p>';
        return;
      }
      
      taggedShots.forEach((shot, index) => {
        const shotElement = document.createElement('div');
        shotElement.className = 'bg-gray-900/50 rounded-lg p-3 border border-gray-700';
        shotElement.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div class="flex items-center space-x-2">
              <span class="text-xs font-mono bg-gray-800 px-2 py-1 rounded">${shot.scene}_${shot.shot}</span>
              <span class="text-xs font-semibold text-cyan-400">${shot.tag.split(', ').map(tag => 
                `<span class="tag-chip px-1 py-0.5 rounded mr-1">${tag}</span>`
              ).join('')}</span>
            </div>
            <button onclick="removeTaggedShot(${index})" class="text-gray-500 hover:text-red-400 transition-colors">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="text-sm text-gray-300 mb-2">${shot.text}</div>
          ${shot.comment ? `<div class="text-xs text-gray-400 italic">Note: ${shot.comment}</div>` : ''}
        `;
        container.appendChild(shotElement);
      });
    }

    // Remove a tagged shot
    function removeTaggedShot(index) {
      const shotToRemove = taggedShots[index];
      taggedShots.splice(index, 1);
      updateTaggedCount();
      saveToLocalStorage();
      renderTaggedShots();
      
      // Also remove the highlight from the script
      const spans = document.querySelectorAll('#scriptInput span.selected-text');
      spans.forEach(span => {
        if (span.textContent === shotToRemove.text && 
            span.dataset.scene === shotToRemove.scene && 
            span.dataset.shot === shotToRemove.shot) {
          const textNode = document.createTextNode(span.textContent);
          span.parentNode.replaceChild(textNode, span);
        }
      });
    }

    // Clear all tagged shots
    function clearAllTags() {
      if (confirm('Are you sure you want to clear all tagged shots?')) {
        taggedShots = [];
        updateTaggedCount();
        saveToLocalStorage();
        renderTaggedShots();
        
        // Remove all highlights from the script
        const spans = document.querySelectorAll('#scriptInput span.selected-text');
        spans.forEach(span => {
          const textNode = document.createTextNode(span.textContent);
          span.parentNode.replaceChild(textNode, span);
        });
      }
    }

    // Update statistics
    function updateStats() {
      // Group by VFX type
      const statsByType = {};
      const statsByComplexity = { simple: 0, medium: 0, complex: 0 };
      
      taggedShots.forEach(shot => {
        // Extract base type (before SIMPL/MED/COMPLEX)
        const baseType = shot.tag.replace(/\s(SIMPL|MED|COMPLEX)$/, '');
        
        if (!statsByType[baseType]) {
          statsByType[baseType] = { simple: 0, medium: 0, complex: 0, total: 0 };
        }
        
        // Count by complexity
        if (shot.tag.includes('SIMPL')) {
          statsByType[baseType].simple++;
          statsByComplexity.simple++;
        } else if (shot.tag.includes('MED')) {
          statsByType[baseType].medium++;
          statsByComplexity.medium++;
        } else if (shot.tag.includes('COMPLEX')) {
          statsByType[baseType].complex++;
          statsByComplexity.complex++;
        }
        
        statsByType[baseType].total++;
      });
      
      // Update stats table
      const tableBody = document.getElementById('statsTableBody');
      tableBody.innerHTML = '';
      
      for (const [type, counts] of Object.entries(statsByType)) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${type}</td>
          <td>${counts.simple}</td>
          <td>${counts.medium}</td>
          <td>${counts.complex}</td>
          <td>${counts.total}</td>
        `;
        tableBody.appendChild(row);
      }
      
      // Simple chart for VFX types
      const typeChart = document.getElementById('vfxTypeChart');
      typeChart.innerHTML = `
        <div class="h-full flex items-end space-x-1">
          ${Object.entries(statsByType).map(([type, counts]) => `
            <div class="flex-1 flex flex-col items-center">
              <div 
                class="w-full bg-gradient-to-t from-cyan-500 to-blue-600 rounded-t-sm" 
                style="height: ${(counts.total / Math.max(1, taggedShots.length)) * 100}%"
              ></div>
              <div class="text-xs text-gray-400 mt-1 truncate w-full text-center">${type.split(' ')[0]}</div>
            </div>
          `).join('')}
        </div>
      `;
      
      // Simple chart for complexity
      const complexityChart = document.getElementById('complexityChart');
      complexityChart.innerHTML = `
        <div class="h-full flex items-center justify-center">
          <div class="relative w-32 h-32">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path 
                class="circle-fill-1" 
                stroke-dasharray="${statsByComplexity.simple}, 100" 
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
              />
              <path 
                class="circle-fill-2" 
                stroke-dasharray="${statsByComplexity.medium}, 100" 
                stroke-dashoffset="${-statsByComplexity.simple}" 
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
              />
              <path 
                class="circle-fill-3" 
                stroke-dasharray="${statsByComplexity.complex}, 100" 
                stroke-dashoffset="${-(statsByComplexity.simple + statsByComplexity.medium)}" 
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
              />
            </svg>
            <div class="absolute inset-0 flex items-center justify-center flex-col">
              <div class="text-2xl font-bold text-cyan-400">${taggedShots.length}</div>
              <div class="text-xs text-gray-400">Total Shots</div>
            </div>
          </div>
        </div>
        <style>
          .circular-chart {
            display: block;
            margin: 10px auto;
            max-width: 80%;
            max-height: 250px;
          }
          .circle-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 3;
          }
          .circle-fill-1 {
            fill: none;
            stroke: #00d4ff;
            stroke-width: 3;
            animation: circle-fill 1s ease-out forwards;
          }
          .circle-fill-2 {
            fill: none;
            stroke: #7c3aed;
            stroke-width: 3;
            animation: circle-fill 1s ease-out forwards;
          }
          .circle-fill-3 {
            fill: none;
            stroke: #10b981;
            stroke-width: 3;
            animation: circle-fill 1s ease-out forwards;
          }
          @keyframes circle-fill {
            0% { stroke-dasharray: 0, 100; }
          }
        </style>
      `;
    }

    // Export to CSV
    function exportCSV() {
      if (taggedShots.length === 0) {
        alert('No tagged shots to export.');
        return;
      }
      
      let csv = 'Scene,Shot,VFX Type,Description,Notes\n';
      
      taggedShots.forEach(shot => {
        csv += `"${shot.scene}","${shot.shot}","${shot.tag.replace(/"/g, '""')}","${shot.text.replace(/"/g, '""')}","${shot.comment.replace(/"/g, '""')}"\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'vfx_bidbot_export.csv';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Export to JSON
    function exportJSON() {
      if (taggedShots.length === 0) {
        alert('No tagged shots to export.');
        return;
      }
      
      const data = {
        metadata: {
          generatedAt: new Date().toISOString(),
          totalShots: taggedShots.length
        },
        shots: taggedShots
      };
      
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'vfx_bidbot_export.json';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Save to localStorage
    function saveToLocalStorage() {
      localStorage.setItem('vfxBidbotData', JSON.stringify({
        taggedShots,
        fontSize,
        scriptContent: document.getElementById('scriptInput').innerHTML
      }));
    }

    // Load from localStorage
    function loadFromLocalStorage() {
      const savedData = localStorage.getItem('vfxBidbotData');
      if (savedData) {
        const data = JSON.parse(savedData);
        taggedShots = data.taggedShots || [];
        fontSize = data.fontSize || 12;
        
        if (data.scriptContent) {
          document.getElementById('scriptInput').innerHTML = data.scriptContent;
        }
        
        updateFontSize(fontSize);
        renderTaggedShots();
      }
    }
  </script>
</body>
</html>
