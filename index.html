<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BidCraft - VFX Bidding tool</title>
  <style>
    html {
      font-size: 80%;
    }
    
    .rotate-180 {
      transform: rotate(180deg);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(0, 212, 255, 0.5);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 212, 255, 0.7);
    }
    
    /* Custom styles that Tailwind can't handle easily */
    
    body {
      font-size: 0.9rem;
      background: linear-gradient(to bottom, #0a0f1a, #090e17, #0a0f1a) !important;
    }
    .gradient-text {
      background: linear-gradient(45deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .tag-chip {
      background: rgba(124, 58, 237, 0.2);
      color: #a78bfa;
    }
    
    .selected-text {
      vertical-align: sub;
      background-color: #fffacd;
      color: inherit;
      position: relative;
      bottom: -0.2em;
    }
    
    #scriptInput {
      white-space: pre-wrap;
      font-size: 0.8rem;
      line-height: 1.4;
    }
    
    /* Animation classes */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeOut {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
      }
    }
    
    .animate-fade-in-up {
      animation: fadeInUp 0.3s ease-out forwards;
    }
    
    .animate-fade-out {
      animation: fadeOut 0.3s ease-out forwards;
    }
    
    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
      
      .panel-height {
        height: 50vh;
      }
    }
    
    @media (min-width: 1920px) {
      .container {
        max-width: 1800px;
      }
    }
    
    /* Coffee stain styling */
    .coffee-stain {
      position: absolute;
      opacity: 0.1;
      z-index: 0;
      pointer-events: none;
    }
    
    .coffee-stain-1 {
      top: 20%;
      right: 10%;
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, #5c3a21 0%, transparent 70%);
      border-radius: 50%;
      transform: rotate(15deg);
    }
    
    .coffee-stain-2 {
      bottom: 15%;
      left: 15%;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #5c3a21 0%, transparent 70%);
      border-radius: 50%;
      transform: rotate(-10deg);
    }
    
    /* Scene and shot input styling */
    .scene-shot-input {
      width: 60px;
      text-transform: uppercase;
    }
    
    .shot-input {
      width: 60px;
    }
    
    /* Stats table styling */
    .stats-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .stats-table th, .stats-table td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .stats-table th {
      background-color: rgba(0, 0, 0, 0.2);
      font-weight: 600;
    }
    
    .stats-table tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    /* Tag button active state */
    .tag-button.active {
      background: rgba(0, 212, 255, 0.2);
      border-color: rgba(0, 212, 255, 0.5);
      color: #00d4ff;
    }
    /* Font size slider styles */
    .font-size-control {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 20px;
    }
    
    .font-size-slider {
      -webkit-appearance: none;
      width: 100px;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      outline: none;
    }
    
    .font-size-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #00d4ff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .font-size-slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: #00a8d4;
    }
    
    .font-size-value {
      min-width: 30px;
      text-align: center;
      font-size: 0.8rem;
      color: #00d4ff;
    }
    
    /* Tag management styles */
    .tag-management-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    
    .tag-management-table th {
      background-color: rgba(0, 0, 0, 0.3);
      padding: 8px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 0.8rem;
    }
    
    .tag-management-table td {
      padding: 8px 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .tag-management-table input {
      width: 100%;
      padding: 6px 8px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      color: white;
    }
    
    .tag-management-table select {
      width: 100%;
      padding: 6px 8px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      color: white;
    }
    
    .tag-management-table .action-cell {
      width: 40px;
      text-align: center;
    }
    
    .tag-management-table .action-cell button {
      background: transparent;
      border: none;
      color: #ff6b6b;
      cursor: pointer;
      font-size: 1rem;
    }
    
    .tag-management-table .action-cell button:hover {
      color: #ff3b3b;
    }
    
    .tag-group-select {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      padding: 6px 8px;
      color: white;
      width: 100%;
    }
    
    .tag-group-select:focus {
      outline: none;
      border-color: #00d4ff;
    }
    
    .tag-management-actions {
      display: flex;
      gap: 8px;
      margin-top: 1rem;
    }
    
    .tag-management-actions button {
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .tag-management-actions button:hover {
      transform: translateY(-2px);
    }
    
    .tag-management-actions button:active {
      transform: translateY(0);
    }
    
    .tag-management-actions .save-btn {
      background: linear-gradient(to right, #00d4ff, #0077ff);
      color: white;
      border: none;
    }
    
    .tag-management-actions .add-btn {
      background: linear-gradient(to right, #7c3aed, #5e35b1);
      color: white;
      border: none;
    }
    
    .tag-management-actions .reset-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .tag-management-actions .cancel-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .tag-group-option {
      padding: 4px 8px;
    }
    
    .tag-group-option:hover {
      background: rgba(0, 212, 255, 0.2);
    }
    
    .tag-management-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .tag-management-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #00d4ff;
    }
    
    .tag-management-header p {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
    }

    /* PDF Import Modal */
    .pdf-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .pdf-modal-content {
      background-color: #1a202c;
      border-radius: 0.5rem;
      width: 90%;
      max-width: 600px;
      padding: 1.5rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      border: 1px solid #2d3748;
    }

    .pdf-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #2d3748;
    }

    .pdf-modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #00d4ff;
    }

    .pdf-modal-close {
      background: none;
      border: none;
      color: #718096;
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .pdf-modal-close:hover {
      color: #e2e8f0;
    }

    .pdf-modal-body {
      margin-bottom: 1.5rem;
    }

    .pdf-modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }

    .pdf-modal-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pdf-modal-btn-primary {
      background: linear-gradient(to right, #00d4ff, #0077ff);
      color: white;
      border: none;
    }

    .pdf-modal-btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .pdf-modal-btn:hover {
      transform: translateY(-1px);
    }

    .pdf-modal-btn:active {
      transform: translateY(0);
    }

    .pdf-dropzone {
      border: 2px dashed #4a5568;
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 1rem;
    }

    .pdf-dropzone:hover {
      border-color: #00d4ff;
      background-color: rgba(0, 212, 255, 0.05);
    }

    .pdf-dropzone-active {
      border-color: #00d4ff;
      background-color: rgba(0, 212, 255, 0.1);
    }

    .pdf-dropzone-icon {
      font-size: 2.5rem;
      color: #4a5568;
      margin-bottom: 0.5rem;
    }

    .pdf-dropzone-text {
      color: #a0aec0;
      margin-bottom: 0.5rem;
    }

    .pdf-dropzone-hint {
      color: #718096;
      font-size: 0.875rem;
    }

    .pdf-progress {
      width: 100%;
      height: 6px;
      background-color: #2d3748;
      border-radius: 3px;
      margin-top: 1rem;
      overflow: hidden;
      display: none;
    }

    .pdf-progress-bar {
      height: 100%;
      background: linear-gradient(to right, #00d4ff, #0077ff);
      width: 0%;
      transition: width 0.3s ease;
    }

    .pdf-status {
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: #a0aec0;
      text-align: center;
      display: none;
    }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- PDF.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
  </script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-100 min-h-screen">
  <!-- Header -->
  <header class="bg-gray-950/95 backdrop-blur-md border-b border-gray-800 p-2 flex flex-col md:flex-row justify-between items-center sticky top-0 z-50">
    <div class="flex items-center space-x-2 mb-2 md:mb-0">
        <img src="https://iili.io/FGDJJI4.png" alt="logo" class="h-7 w-7 object-contain" />
        <h1 class="text-2xl font-bold gradient-text">BIDCRAFT</h1>
        <a href="https://www.linkedin.com/in/mvierendeel/" target="_blank" class="text-xs text-gray-400 hover:text-gray-300 transition-colors align-baseline">created by Mathieu Vierendeel</a>
    </div>
    <div class="flex flex-wrap justify-center gap-2">
      <button onclick="exportCSV()" class="flex items-center space-x-1 px-3 py-1.5 bg-gradient-to-r from-gray-700 to-blue-900 hover:from-gray-800 hover:to-blue-950 text-white rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5">
        <i class="fas fa-file-csv"></i>
        <span>Export CSV</span>
      </button>
      <button onclick="exportJSON()" class="flex items-center space-x-1 px-3 py-1.5 bg-gradient-to-r from-gray-700 to-purple-900 hover:from-gray-800 hover:to-purple-950 text-white rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5">
        <i class="fas fa-file-code"></i>
        <span>Export JSON</span>
      </button>
      <button onclick="openPdfModal()" class="flex items-center space-x-1 px-3 py-1.5 bg-gradient-to-r from-gray-700 to-green-900 hover:from-gray-800 hover:to-green-950 text-white rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5">
        <i class="fas fa-file-pdf"></i>
        <span>Import PDF</span>
      </button>
    </div>
  </header>

  <!-- PDF Import Modal -->
  <div id="pdfModal" class="pdf-modal">
    <div class="pdf-modal-content">
      <div class="pdf-modal-header">
        <h3 class="pdf-modal-title">Import Movie Script PDF</h3>
        <button class="pdf-modal-close" onclick="closePdfModal()">&times;</button>
      </div>
      <div class="pdf-modal-body">
        <div id="pdfDropzone" class="pdf-dropzone" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
          <div class="pdf-dropzone-icon">
            <i class="fas fa-file-pdf"></i>
          </div>
          <div class="pdf-dropzone-text">Drag & drop your script PDF here</div>
          <div class="pdf-dropzone-hint">or click to browse files</div>
          <input type="file" id="pdfFileInput" accept=".pdf" style="display: none;" onchange="handleFileSelect(event)">
        </div>
        <div class="pdf-progress" id="pdfProgress">
          <div class="pdf-progress-bar" id="pdfProgressBar"></div>
        </div>
        <div class="pdf-status" id="pdfStatus"></div>
      </div>
      <div class="pdf-modal-footer">
        <button class="pdf-modal-btn pdf-modal-btn-secondary" onclick="closePdfModal()">Cancel</button>
        <button class="pdf-modal-btn pdf-modal-btn-primary" id="pdfImportBtn" onclick="importPdf()" disabled>Import</button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container mx-auto px-3 py-4 flex flex-row gap-4 min-h-[calc(100vh-8rem)]">
    <!-- Script Panel -->
    <div class="flex-1 bg-gray-900/90 backdrop-blur-sm rounded-xl border border-gray-800 flex flex-col h-full overflow-y-auto">
      <div class="bg-gray-900/50 p-2 border-b border-gray-700 flex justify-between items-center">
        <h2 class="text-base font-semibold flex items-center space-x-1">
          <i class="fas fa-scroll text-cyan-400"></i>
          <span>Script (Paste here)</span>
        </h2>
        <div class="flex items-center gap-2">
          <div class="font-size-control">
            <i class="fas fa-font text-gray-400 text-sm"></i>
            <input
                type="range"
                min="8"
                max="24"
                value="12"
                class="font-size-slider"
                id="fontSizeSlider"
                oninput="updateFontSize(this.value)"
            >
            <span class="font-size-value" id="fontSizeValue">12px</span>
          </div>
          <button onclick="clearScript()" class="flex items-center space-x-1 px-2 py-1 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-all">
            <i class="fas fa-eraser"></i>
            <span class="text-xs">Clear</span>
          </button>
        </div>
      </div>
      <div
         id="scriptInput"
        contenteditable="true"
        onmouseup="storeSelection()"
        onkeyup="storeSelection()"
        class="flex-1 p-3 bg-white text-black overflow-y-auto focus:outline-none focus:ring-2 focus:ring-cyan-500/50 rounded-b-lg relative"
        style="font-family: Courier, monospace; white-space: pre-wrap;"
      >
        INT. LABORATORY - DAY

        A CG ALIEN runs across the lab, knocking over GLOWING VIALS. The
        SCIENTIST yells and dives under a table as a MONITOR EXPLODES.

        EXT. FOREST - NIGHT

        FOG rolls between the trees. A DRONE CAMERA flies overhead.
        LIGHTNING illuminates the ALIEN SPACECRAFT hovering above.

        INT. SPACESHIP BRIDGE - CONTINUOUS

        The ALIEN COMMANDER studies Earth through a HOLOGRAPHIC DISPLAY.
        SPARKS fly from damaged control panels as ALARMS BLARE.

        EXT. CITY STREET - DAY

        A MASSIVE EXPLOSION rocks the downtown area. CARS flip through the
        air as DEBRIS rains down. CITIZENS run screaming as BUILDINGS
        COLLAPSE in the distance.
      </div>
    </div>

    <!-- Controls Panel -->
    <div class="w-[30%] min-w-[300px] bg-gray-900/80 backdrop-blur-sm rounded-xl border border-gray-800 flex flex-col sticky top-[4.5rem] h-[calc(100vh-8rem)] overflow-y-auto">
      <!-- Tab Navigation -->
      <div class="bg-gray-900/50 flex border-b border-gray-700">
        <button
            onclick="switchTab('tagging')"
            class="tab-button flex-1 py-3 px-4 text-center font-medium border-b-2 border-cyan-500 text-cyan-400 hover:bg-gray-800/50 transition-all flex items-center justify-center space-x-2"
            id="tagging-tab-btn"
        >
          <i class="fas fa-tag"></i>
          <span>VFX Tagging</span>
        </button>
        <button
            onclick="switchTab('history')"
            class="tab-button flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent hover:bg-gray-800/50 transition-all flex items-center justify-center space-x-2"
            id="history-tab-btn"
        >
          <i class="fas fa-history"></i>
          <span>Tagged Shots</span>
          <span id="taggedCount" class="bg-cyan-500/20 text-cyan-400 text-2xs px-1.5 py-0.5 rounded-full">0</span>
        </button>
        <button
            onclick="switchTab('manage-tags')"
            class="tab-button flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent hover:bg-gray-800/50 transition-all flex items-center justify-center space-x-2"
            id="manage-tags-tab-btn"
        >
          <i class="fas fa-tags"></i>
          <span>Manage Tags</span>
        </button>
      </div>

      <!-- Tab Contents -->
      <div class="flex-1 overflow-y-auto overflow-x-hidden">
        <!-- Tagging Tab -->
        <div id="tagging-tab" class="tab-content p-4 h-full">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-400 mb-2">Selected Text:</label>
            <div id="selectedPreview" class="bg-gray-900/50 border border-gray-700 rounded-lg p-3 text-gray-300 italic min-h-16">
              (Select text in the script to preview it here)
            </div>
          </div>

          <!-- Comment Section -->
          <div class="mb-4">
            <label for="commentBox" class="block text-sm font-medium text-gray-400 mb-2">
              <i class="fas fa-comment-dots mr-2"></i>Additional Notes:
            </label>
            <textarea
              id="commentBox"
              placeholder="Add any additional notes about the VFX requirements..."
              class="w-full px-3 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300 min-h-24 text-sm"
            ></textarea>
          </div>

          <!-- Scene and Shot Input -->
          <div class="grid grid-cols-2 gap-3 mb-4">
            <div>
              <label for="sceneInput" class="block text-sm font-medium text-gray-400 mb-1">
                <i class="fas fa-map-marker-alt mr-1"></i>Scene (3-4 letters)
              </label>
              <input
                type="text"
                id="sceneInput"
                maxlength="4"
                placeholder="SCN"
                class="scene-shot-input w-full px-3 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300 text-sm uppercase"
              >
            </div>
            <div>
              <label for="shotInput" class="block text-sm font-medium text-gray-400 mb-1">
                <i class="fas fa-hashtag mr-1"></i>Shot (3-4 digits)
              </label>
              <input
                type="text"
                id="shotInput"
                maxlength="4"
                placeholder="001"
                class="shot-input w-full px-3 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300 text-sm"
              >
            </div>
          </div>

          <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 mb-4">
            <button
              onclick="tagVFX()"
              class="flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5"
            >
              <i class="fas fa-tag"></i>
              <span>Tag VFX</span>
            </button>
            <button
              onclick="clearSelection()"
              class="flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-all hover:shadow-lg hover:-translate-y-0.5"
            >
              <i class="fas fa-eraser"></i>
              <span>Clear Selection</span>
            </button>
          </div>

          <div class="relative mb-4">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search text-gray-500"></i>
            </div>
            <input
                type="text"
              id="tagSearch"
              placeholder="Search tags..."
              onkeyup="filterTags()"
              class="w-full pl-10 pr-4 py-2 bg-gray-900/50 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 text-gray-300"
            >
          </div>

          <!-- Accordion for Tag Groups -->
          <div id="tagging-accordions" class="space-y-4">
            <!-- Tag groups will be dynamically generated here -->
          </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content p-4 hidden h-full">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-cyan-400">Tagged Shots</h3>
            <button onclick="clearAllTags()" class="px-3 py-1 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg text-sm transition-all">
              <i class="fas fa-trash mr-1"></i> Clear All
            </button>
          </div>
          <div id="taggedShotsList" class="space-y-2 overflow-auto max-h-[calc(100%-3rem)]">
            <!-- Tagged shots will appear here -->
          </div>
        </div>
        
        <!-- Manage Tags Tab -->
        <div id="manage-tags-tab" class="tab-content p-4 hidden h-full">
          <div class="tag-management-header">
            <h3>Manage VFX Tags</h3>
            <p id="tag-count">0 tags</p>
          </div>
          
          <p class="text-sm text-gray-400 mb-4">
            Edit existing tags or add new ones. Changes will be reflected in the tagging tab after saving.
          </p>
          
          <table class="tag-management-table">
            <thead>
              <tr>
                <th>VFX Tag</th>
                <th>Group</th>
                <th class="action-cell">Action</th>
              </tr>
            </thead>
            <tbody id="tag-management-body">
              <!-- Tag rows will be added here -->
            </tbody>
          </table>
          
          <div class="tag-management-actions">
            <button onclick="addNewTagRow()" class="add-btn">
              <i class="fas fa-plus mr-2"></i>Add Tag
            </button>
            <button onclick="saveTagChanges()" class="save-btn">
              <i class="fas fa-save mr-2"></i>Update Tags
            </button>
          </div>
          
          <div class="mt-6">
            <h4 class="text-sm font-medium text-cyan-400 mb-2">Tag Groups</h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
              <div class="bg-gray-900/50 p-3 rounded-lg">
                <div class="flex items-center mb-2">
                  <i class="fas fa-layer-group text-cyan-400 mr-2"></i>
                  <span class="text-sm font-medium">2D COMP & DMP</span>
                </div>
                <p class="text-xs text-gray-400">Compositing & Digital Matte Painting</p>
              </div>
              <div class="bg-gray-900/50 p-3 rounded-lg">
                <div class="flex items-center mb-2">
                  <i class="fas fa-users text-purple-400 mr-2"></i>
                  <span class="text-sm font-medium">CROWDS</span>
                </div>
                <p class="text-xs text-gray-400">Crowd simulation and duplication</p>
              </div>
              <div class="bg-gray-900/50 p-3 rounded-lg">
                <div class="flex items-center mb-2">
                  <i class="fas fa-shapes text-green-400 mr-2"></i>
                  <span class="text-sm font-medium">2D OTHER</span>
                </div>
                <p class="text-xs text-gray-400">Miscellaneous 2D effects</p>
              </div>
              <div class="bg-gray-900/50 p-3 rounded-lg">
                <div class="flex items-center mb-2">
                  <i class="fas fa-cube text-yellow-400 mr-2"></i>
                  <span class="text-sm font-medium">3D FULL CGI</span>
                </div>
                <p class="text-xs text-gray-400">Full computer-generated imagery</p>
              </div>
              <div class="bg-gray-900/50 p-3 rounded-lg">
                <div class="flex items-center mb-2">
                  <i class="fas fa-mountain text-red-400 mr-2"></i>
                  <span class="text-sm font-medium">3D ENVIRO</span>
                </div>
                <p class="text-xs text-gray-400">Environment creation</p>
              </div>
              <div class="bg-gray-900/50 p-3 rounded-lg">
                <div class="flex items-center mb-2">
                  <i class="fas fa-fire text-orange-400 mr-2"></i>
                  <span class="text-sm font-medium">3D FX</span>
                </div>
                <p class="text-xs text-gray-400">Special effects simulation</p>
              </div>
              <div class="bg-gray-900/50 p-3 rounded-lg">
                <div class="flex items-center mb-2">
                  <i class="fas fa-cubes text-blue-400 mr-2"></i>
                  <span class="text-sm font-medium">ASSETS</span>
                </div>
                <p class="text-xs text-gray-400">3D models and assets</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Global variables
    let currentSelection = null;
    let selectedTag = null;
    let taggedShots = [];
    let fontSize = 12;
    let pdfFile = null;
    let pdfTextContent = '';

    // Tag groups with display names and icons
    const tagGroups = [
      { id: '2d-comp', name: '2D COMP & DMP', icon: 'fas fa-layer-group' },
      { id: 'crowds', name: 'CROWDS', icon: 'fas fa-users' },
      { id: '2d-other', name: '2D OTHER', icon: 'fas fa-shapes' },
      { id: '3d-full-cgi', name: '3D FULL CGI', icon: 'fas fa-cube' },
      { id: '3d-enviro', name: '3D ENVIRO', icon: 'fas fa-mountain' },
      { id: '3d-object', name: '3D OBJECT', icon: 'fas fa-cube' },
      { id: '3d-character', name: '3D CHARACTER', icon: 'fas fa-user-astronaut' },
      { id: '3d-fx', name: '3D FX', icon: 'fas fa-fire' },
      { id: 'previs', name: 'PREVIS', icon: 'fas fa-video' },
      { id: 'assets', name: 'ASSETS', icon: 'fas fa-cubes' }
    ];

    // Default VFX tags
    let vfxTags = [
      { tag: "2D COMP COMPLEX", group: "2d-comp" },
      { tag: "2D COMP MED", group: "2d-comp" },
      { tag: "2D COMP SIMPL", group: "2d-comp" },
      { tag: "2D DMP COMPLEX", group: "2d-comp" },
      { tag: "2D DMP MED", group: "2d-comp" },
      { tag: "2D DMP SIMPL", group: "2d-comp" },
      { tag: "2D CROWD DUPL COMPLEX", group: "crowds" },
      { tag: "2D CROWD DUPL MED", group: "crowds" },
      { tag: "2D CROWD DUPL SIMPL", group: "crowds" },
      { tag: "3D CROWDS SIMPL", group: "crowds" },
      { tag: "3D CROWDS MED", group: "crowds" },
      { tag: "3D CROWDS COMPLEX", group: "crowds" },
      { tag: "2D BLOOD/MUZZLE FLASH/BULLET HIT", group: "2d-other" },
      { tag: "2D FACE REPL", group: "2d-other" },
      { tag: "2D FILTER", group: "2d-other" },
      { tag: "2D FX STOCK FOOTAGE", group: "2d-other" },
      { tag: "2D HUD OVERLAY", group: "2d-other" },
      { tag: "2D SCREEN REPLACEMENT", group: "2d-other" },
      { tag: "TITLE CARD", group: "2d-other" },
      { tag: "3D FULL CGI SIMPL", group: "3d-full-cgi" },
      { tag: "3D FULL CGI MED", group: "3d-full-cgi" },
      { tag: "3D FULL CGI COMPLEX", group: "3d-full-cgi" },
      { tag: "3D ENVIRO SIMPL", group: "3d-enviro" },
      { tag: "3D ENVIRO MED", group: "3d-enviro" },
      { tag: "3D ENVIRO COMPLEX", group: "3d-enviro" },
      { tag: "3D OBJECT SIMPL", group: "3d-object" },
      { tag: "3D OBJECT MED", group: "3d-object" },
      { tag: "3D OBJECT COMPLEX", group: "3d-object" },
      { tag: "3D CHARACTER SIMPL", group: "3d-character" },
      { tag: "3D CHARACTER MED", group: "3d-character" },
      { tag: "3D CHARACTER COMPLEX", group: "3d-character" },
      { tag: "3D FX SIMPL", group: "3d-fx" },
      { tag: "3D FX MED", group: "3d-fx" },
      { tag: "3D FX COMPLEX", group: "3d-fx" },
      { tag: "PREVIS SIMPL", group: "previs" },
      { tag: "PREVIS MED", group: "previs" },
      { tag: "PREVIS COMPLEX", group: "previs" }
    ];

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      updateFontSize(12);
      loadFromLocalStorage();
      updateTaggedCount();
      renderTaggingTab();
      renderTagManagementTable();
    });

    // Store the current text selection
    function storeSelection() {
      const selection = window.getSelection();
      if (selection && selection.rangeCount > 0 && !selection.isCollapsed) {
        currentSelection = selection.getRangeAt(0);
        
        // Update the preview
        const preview = document.getElementById('selectedPreview');
        preview.textContent = currentSelection.toString();
        preview.classList.remove('italic');
      }
    }

    // Update font size of script input
    function updateFontSize(size) {
      fontSize = size;
      document.getElementById('scriptInput').style.fontSize = `${size}px`;
      document.getElementById('fontSizeValue').textContent = `${size}px`;
    }

    // Clear the entire script
    function clearScript() {
      if (confirm('Are you sure you want to clear the entire script?')) {
        document.getElementById('scriptInput').innerHTML = '';
      }
    }

    // Select a VFX tag (can select multiple)
    function selectTag(button) {
      // Toggle active state
      button.classList.toggle('active');
      
      // Get all active tags
      selectedTag = Array.from(document.querySelectorAll('.tag-button.active'))
        .map(btn => btn.textContent.trim())
        .join(', ');
    }

    // Tag the selected text with VFX
    function tagVFX() {
      const activeTags = Array.from(document.querySelectorAll('.tag-button.active'))
        .map(btn => btn.textContent.trim());
      
      if (!currentSelection || activeTags.length === 0) {
        alert('Please select text in the script and choose at least one VFX tag.');
        return;
      }

      const scene = document.getElementById('sceneInput').value.trim() || 'SCN';
      const shot = document.getElementById('shotInput').value.trim() || '001';
      const comment = document.getElementById('commentBox').value.trim();
      
      // Get the selected text
      const selectedText = currentSelection.toString();
      
      // Create a span to highlight the tagged text
      const span = document.createElement('span');
      span.className = 'selected-text';
      span.dataset.scene = scene;
      span.dataset.shot = shot;
      // Store tags and assets together in tag attribute for now
      span.dataset.tag = activeTags.join(', ');
      span.dataset.comment = comment;
      
      // Replace the selected text with our span
      currentSelection.deleteContents();
      span.appendChild(document.createTextNode(selectedText));
      currentSelection.insertNode(span);
      
      // Check if we already have this scene/sot combination
      const existingShot = taggedShots.find(s => 
        s.scene === scene && s.shot === shot && s.text === selectedText
      );
      
      if (existingShot) {
        // Merge tags
        const existingTags = existingShot.tag.split(', ');
        const newTags = [...new Set([...existingTags, ...activeTags])]; // Remove duplicates
        existingShot.tag = newTags.join(', ');
      } else {
        // Add new shot with all tags
        taggedShots.push({
          scene,
          shot,
          tag: activeTags.join(', '),
          text: selectedText,
          comment
        });
      }
      
      // Update UI
      updateTaggedCount();
      saveToLocalStorage();
      renderTaggedShots();
      
      // Clear selection
      clearSelection();
    }

    // Clear the current selection (keeps tags selected)
    function clearSelection() {
      currentSelection = null;
      document.getElementById('selectedPreview').textContent = '(Select text in the script to preview it here)';
      document.getElementById('selectedPreview').classList.add('italic');
      document.getElementById('commentBox').value = '';
    }

    // Switch between tabs
    function switchTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // Show selected tab
      document.getElementById(`${tabName}-tab`).classList.remove('hidden');
      
      // Update tab buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-cyan-500', 'text-cyan-400');
        btn.classList.add('border-transparent');
      });
      
      document.getElementById(`${tabName}-tab-btn`).classList.add('border-cyan-500', 'text-cyan-400');
      
      // If switching to stats tab, update stats
      if (tabName === 'stats') {
        updateStats();
      }
    }

    // Toggle accordion sections
    function toggleAccordion(header) {
      const content = header.nextElementSibling;
      const icon = header.querySelector('.fa-chevron-down');
      
      content.classList.toggle('hidden');
      icon.classList.toggle('rotate-180');
    }

    // Filter tags based on search input
    function filterTags() {
      const searchTerm = document.getElementById('tagSearch').value.toLowerCase();
      
      document.querySelectorAll('.tag-group').forEach(group => {
        let hasMatches = false;
        const buttons = group.querySelectorAll('.tag-button');
        
        buttons.forEach(button => {
          const tagText = button.textContent.toLowerCase();
          if (tagText.includes(searchTerm)) {
            button.style.display = 'block';
            hasMatches = true;
          } else {
            button.style.display = 'none';
          }
        });
        
        // Show/hide entire group based on matches
        if (hasMatches || searchTerm === '') {
          group.style.display = 'block';
        } else {
          group.style.display = 'none';
        }
      });
    }

    // Update the tagged shots count
    function updateTaggedCount() {
      document.getElementById('taggedCount').textContent = taggedShots.length;
    }

    // Render the list of tagged shots
    function renderTaggedShots() {
      const container = document.getElementById('taggedShotsList');
      container.innerHTML = '';
      
      if (taggedShots.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic text-center py-4">No tagged shots yet</p>';
        return;
      }
      
      taggedShots.forEach((shot, index) => {
        const shotElement = document.createElement('div');
        shotElement.className = 'bg-gray-900/50 rounded-lg p-3 border border-gray-700';
        shotElement.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div class="flex items-center space-x-2">
              <span class="text-xs font-mono bg-gray-800 px-2 py-1 rounded">${shot.scene}_${shot.shot}</span>
              <span class="text-xs font-semibold text-cyan-400">${shot.tag.split(', ').map(tag => 
                `<span class="tag-chip px-1 py-0.5 rounded mr-1">${tag}</span>`
              ).join('')}</span>
            </div>
            <button onclick="removeTaggedShot(${index})" class="text-gray-500 hover:text-red-400 transition-colors">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="text-sm text-gray-300 mb-2">${shot.text}</div>
          ${shot.comment ? `<div class="text-xs text-gray-400 italic">Note: ${shot.comment}</div>` : ''}
        `;
        container.appendChild(shotElement);
      });
    }

    // Remove a tagged shot
    function removeTaggedShot(index) {
      const shotToRemove = taggedShots[index];
      taggedShots.splice(index, 1);
      updateTaggedCount();
      saveToLocalStorage();
      renderTaggedShots();
      
      // Also remove the highlight from the script
      const spans = document.querySelectorAll('#scriptInput span.selected-text');
      spans.forEach(span => {
        if (span.textContent === shotToRemove.text && 
            span.dataset.scene === shotToRemove.scene && 
            span.dataset.shot === shotToRemove.shot) {
          const textNode = document.createTextNode(span.textContent);
          span.parentNode.replaceChild(textNode, span);
        }
      });
    }

    // Clear all tagged shots
    function clearAllTags() {
      if (confirm('Are you sure you want to clear all tagged shots?')) {
        taggedShots = [];
        updateTaggedCount();
        saveToLocalStorage();
        renderTaggedShots();
        
        // Remove all highlights from the script
        const spans = document.querySelectorAll('#scriptInput span.selected-text');
        spans.forEach(span => {
          const textNode = document.createTextNode(span.textContent);
          span.parentNode.replaceChild(textNode, span);
        });
      }
    }

    // Export to CSV
    function exportCSV() {
      if (taggedShots.length === 0) {
        alert('No tagged shots to export.');
        return;
      }
      
      let csv = 'Scene,Shot,VFX Tags,Description,Notes\n';
      
      taggedShots.forEach(shot => {
        csv += `"${shot.scene}","${shot.shot}","${shot.tag.replace(/"/g, '""')}","${shot.text.replace(/"/g, '""')}","${shot.comment.replace(/"/g, '""')}"\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'vfx_bidbot_export.csv';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Export to JSON
    function exportJSON() {
      if (taggedShots.length === 0) {
        alert('No tagged shots to export.');
        return;
      }
      
      const data = {
        metadata: {
          generatedAt: new Date().toISOString(),
          totalShots: taggedShots.length
        },
        shots: taggedShots.map(shot => ({
          scene: shot.scene,
          shot: shot.shot,
          tags: shot.tag.split(', '),
          description: shot.text,
          notes: shot.comment
        }))
      };
      
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'vfx_bidbot_export.json';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Save to localStorage
    function saveToLocalStorage() {
      localStorage.setItem('vfxBidbotData', JSON.stringify({
        taggedShots,
        fontSize,
        scriptContent: document.getElementById('scriptInput').innerHTML,
        vfxTags
      }));
    }

    // Load from localStorage
    function loadFromLocalStorage() {
      const savedData = localStorage.getItem('vfxBidbotData');
      if (savedData) {
        const data = JSON.parse(savedData);
        taggedShots = data.taggedShots || [];
        fontSize = data.fontSize || 12;
        vfxTags = data.vfxTags || vfxTags;
        
        if (data.scriptContent) {
          document.getElementById('scriptInput').innerHTML = data.scriptContent;
        }
        
        updateFontSize(fontSize);
        renderTaggedShots();
      }
    }

    // Render tagging tab with accordions and tags
    function renderTaggingTab() {
      const container = document.getElementById('tagging-accordions');
      container.innerHTML = '';

      // Group tags by their group
      const tagsByGroup = {};
      vfxTags.forEach(tag => {
        if (!tagsByGroup[tag.group]) {
          tagsByGroup[tag.group] = [];
        }
        tagsByGroup[tag.group].push(tag.tag);
      });

      // Create accordions for each group
      tagGroups.forEach(group => {
        if (tagsByGroup[group.id] && tagsByGroup[group.id].length > 0) {
          const groupElement = document.createElement('div');
          groupElement.className = 'tag-group';
          groupElement.dataset.category = group.id;

          groupElement.innerHTML = `
            <div class="accordion-header flex justify-between items-center p-2 bg-gray-900/50 rounded-lg cursor-pointer" onclick="toggleAccordion(this)">
              <h3 class="text-sm font-semibold uppercase tracking-wider text-cyan-400 flex items-center space-x-2">
                <i class="${group.icon}"></i>
                <span>${group.name}</span>
              </h3>
              <i class="fas fa-chevron-down text-gray-500 transform transition-transform duration-200"></i>
            </div>
            <div class="accordion-content mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2 p-2 hidden">
              ${tagsByGroup[group.id].map(tag => 
                `<button onclick="selectTag(this)" class="tag-button px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-sm text-left transition-all hover:shadow-md">
                  ${tag}
                </button>`
              ).join('')}
            </div>
          `;

          container.appendChild(groupElement);
        }
      });
    }

    // Render tag management table
    function renderTagManagementTable() {
      const container = document.getElementById('tag-management-body');
      container.innerHTML = '';

      vfxTags.forEach((tag, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>
            <input type="text" value="${tag.tag}" class="tag-input" data-index="${index}">
          </td>
          <td>
            <select class="tag-group-select" data-index="${index}">
              ${tagGroups.map(group => 
                `<option value="${group.id}" ${tag.group === group.id ? 'selected' : ''}>${group.name}</option>`
              ).join('')}
            </select>
          </td>
          <td class="action-cell">
            <button onclick="removeTagRow(${index})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        container.appendChild(row);
      });

      document.getElementById('tag-count').textContent = `${vfxTags.length} tags`;
    }

    // Add a new tag row
    function addNewTagRow() {
      vfxTags.push({ tag: "NEW TAG", group: "2d-comp" });
      renderTagManagementTable();
    }

    // Remove a tag row
    function removeTagRow(index) {
      if (confirm('Are you sure you want to remove this tag?')) {
        vfxTags.splice(index, 1);
        renderTagManagementTable();
      }
    }

    // Save tag changes
    function saveTagChanges() {
      // Update tags from inputs
      document.querySelectorAll('.tag-input').forEach(input => {
        const index = input.dataset.index;
        vfxTags[index].tag = input.value;
      });

      // Update groups from selects
      document.querySelectorAll('.tag-group-select').forEach(select => {
        const index = select.dataset.index;
        vfxTags[index].group = select.value;
      });

      // Save and update UI
      saveToLocalStorage();
      renderTaggingTab();

      // Show success message
      const successMsg = document.createElement('div');
      successMsg.className = 'bg-green-600/20 text-green-400 p-2 rounded-lg text-sm mb-4';
      successMsg.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Tags updated successfully!';

      const container = document.getElementById('manage-tags-tab');
      container.insertBefore(successMsg, container.firstChild);

      // Remove message after 3 seconds
      setTimeout(() => {
        successMsg.remove();
      }, 3000);
    }

    // Reset tag changes
    function resetTagChanges() {
      if (confirm('Are you sure you want to reset all changes? This will revert to the last saved tags.')) {
        loadFromLocalStorage();
        renderTagManagementTable();
      }
    }

    // PDF Import Functions
    function openPdfModal() {
      document.getElementById('pdfModal').style.display = 'flex';
    }

    function closePdfModal() {
      document.getElementById('pdfModal').style.display = 'none';
      resetPdfImport();
    }

    function resetPdfImport() {
      pdfFile = null;
      pdfTextContent = '';
      document.getElementById('pdfDropzone').classList.remove('pdf-dropzone-active');
      document.getElementById('pdfImportBtn').disabled = true;
      document.getElementById('pdfProgress').style.display = 'none';
      document.getElementById('pdfStatus').style.display = 'none';
      document.getElementById('pdfStatus').textContent = '';
      document.getElementById('pdfProgressBar').style.width = '0%';
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('pdfDropzone').classList.add('pdf-dropzone-active');
    }

    function handleDragLeave(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('pdfDropzone').classList.remove('pdf-dropzone-active');
    }

    function handleDrop(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('pdfDropzone').classList.remove('pdf-dropzone-active');

      if (e.dataTransfer.files.length) {
        const file = e.dataTransfer.files[0];
        if (file.type === 'application/pdf') {
          handlePdfFile(file);
        } else {
          alert('Please select a PDF file.');
        }
      }
    }

    function handleFileSelect(e) {
      if (e.target.files.length) {
        const file = e.target.files[0];
        if (file.type === 'application/pdf') {
          handlePdfFile(file);
        } else {
          alert('Please select a PDF file.');
        }
      }
    }

    function handlePdfFile(file) {
      pdfFile = file;
      document.getElementById('pdfImportBtn').disabled = false;
      
      // Update UI to show file is ready
      const dropzone = document.getElementById('pdfDropzone');
      dropzone.innerHTML = `
        <div class="text-green-400 mb-2">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="text-sm font-medium text-gray-200">${file.name}</div>
        <div class="text-xs text-gray-400 mt-1">${(file.size / 1024).toFixed(1)} KB</div>
      `;
    }

    async function importPdf() {
      if (!pdfFile) return;

      const progressBar = document.getElementById('pdfProgressBar');
      const progressContainer = document.getElementById('pdfProgress');
      const statusEl = document.getElementById('pdfStatus');

      progressContainer.style.display = 'block';
      statusEl.style.display = 'block';
      statusEl.textContent = 'Processing PDF...';
      
      try {
        const loadingTask = pdfjsLib.getDocument(URL.createObjectURL(pdfFile));
        const pdf = await loadingTask.promise;
        
        let fullText = '';
        const numPages = pdf.numPages;
        
        // Process each page
        for (let i = 1; i <= numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(' ');
          fullText += pageText + '\n\n';
          
          // Update progress
          const progress = (i / numPages) * 100;
          progressBar.style.width = `${progress}%`;
          statusEl.textContent = `Processing page ${i} of ${numPages}...`;
        }
        
        // Format the text for better readability
        fullText = formatScriptText(fullText);
        
        // Insert into the script input
        document.getElementById('scriptInput').innerHTML = fullText;
        
        // Update status
        statusEl.innerHTML = `<span class="text-green-400">Successfully imported ${numPages} pages!</span>`;
        
        // Save to localStorage
        saveToLocalStorage();
        
        // Close modal after 2 seconds
        setTimeout(() => {
          closePdfModal();
        }, 2000);
      } catch (error) {
        console.error('PDF processing error:', error);
        statusEl.innerHTML = `<span class="text-red-400">Error processing PDF: ${error.message}</span>`;
      }
    }

    function formatScriptText(text) {
      // First normalize all line breaks
      text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
      
      // Split into lines
      const lines = text.split('\n');
      let htmlOutput = '';
      let prevBlank = false;
      
      for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();
        
        // Skip lines that are only numbers (page numbers)
        if (/^\d{1,4}$/.test(line)) continue;
        
        // Skip empty lines if previous line was also empty
        if (line === "") {
          if (!prevBlank) {
            htmlOutput += "<br>";
            prevBlank = true;
          }
          continue;
        }
        
        // Scene headings (INT., EXT., etc.)
        if (/^(INT\.|EXT\.|EXT\/INT\.?|INT\/EXT\.?)/i.test(line)) {
          htmlOutput += "<div style='page-break-before: always;'></div>";
          htmlOutput += `<strong>${line.toUpperCase()}</strong><br>`;
          prevBlank = false;
          continue;
        }
        
        // Character names (all caps, 2-30 chars)
        if (/^[A-Z\s\-]{2,30}$/.test(line)) {
          htmlOutput += `<div style="text-align: center; font-weight: bold;">${line}</div>`;
          prevBlank = false;
          continue;
        }
        
        // Regular content
        htmlOutput += `${line}<br>`;
        prevBlank = false;
      }
      
      return htmlOutput;
    }

    // Click handler for the dropzone to trigger file input
    document.getElementById('pdfDropzone').addEventListener('click', function() {
      document.getElementById('pdfFileInput').click();
    });
  </script>
</body>
</html>
